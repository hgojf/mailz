.PHONY: clean-mailz install-mailz tidy-mailz

SRCS_MAILZ_NOGEN = _err.c content-proc.c imsg-blocking.c maildir.c mailz.c
SRCS_MAILZ = conf-lex.c conf-parse.c
SRCS_MAILZ += ${SRCS_MAILZ_NOGEN} 
DEPS_MAILZ = $(SRCS_MAILZ:.c=.d)
OBJS_MAILZ = $(SRCS_MAILZ:.c=.o)

LDFLAGS_MAILZ = -lutil

clean-mailz:
	rm -f mailz conf-parse.c conf-parse.h conf-lex.c \
	      ${DEPS_MAILZ} ${OBJS_MAILZ}

conf-parse.h conf-parse.c: parse.y
	$(YACC) -d -o conf-parse.c parse.y

conf-lex.c: lex.l
	$(LEX) -o $@ lex.l

conf-lex.o: conf-parse.h

install-mailz:
	$(INSTALL) -m 0755 mailz ${PREFIX}/bin/

mailz: ${OBJS_MAILZ}
	$(CC) -o $@ ${LDFLAGS_MAILZ} ${OBJS_MAILZ}

tidy-mailz:
	clang-tidy ${TIDYFLAGS} ${SRCS_MAILZ_NOGEN} -- ${CFLAGS}

-include ${DEPS_MAILZ}
