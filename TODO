Add a regression test suite.

Improve error messages.
